<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  <title>College Search & recommend</title>
</head>

<body>
  <div class="container">
    <form>
      <div class="form-group">
        <label>Who are you?</label>
        <input type="text" value="ddd" class="form-control" aria-describedby="emailHelp"
          placeholder="Enter your name ...">
        <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
      </div>
      <div class="form-group">
        <label>Which college?</label>
        <input type="text" value="uw" class="form-control" placeholder="Enter college name ...">
      </div>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </div>
  <div class="container">
    <h2>History:</h2>
    <p id="history"></p>

    <h2>Occurance:</h2>
    <p id="occrance"></p>

    <h2>Log:</h2>
    <p id="log"></p>
  </div>

  <script type="text/javascript">
    let form = document.querySelector('form');
    let log = document.getElementById('log');
    let historyP = document.getElementById('history');
    let occranceP = document.getElementById('occrance');
    form.addEventListener('submit', logSubmit);
    let searchHistory = []; // keep track of query and its occurance

    // handle form sumbit behavior
    function logSubmit(event) {
      event.preventDefault();
      // console.log(this.querySelectorAll('input')[1].value);
      let newP = addSearchContent(this.querySelectorAll('input')[0].value, this.querySelectorAll('input')[1].value);
      log.prepend(newP);
      // append college to array and update the DOM
      searchHistory.push(this.querySelectorAll('input')[1].value);
      displaySearchHistory(searchHistory);
    }

    // generate the given information inside a p tag
    function addSearchContent(user, college) {
      let pTag = document.createElement('p');
      // console.log(user + " search " + college + ` at ${event.timeStamp};`);
      let timeStamp = Math.floor(parseFloat(event.timeStamp));
      pTag.textContent = user + " searched " + college + " @Time Stamp: " + timeStamp;
      return pTag;
    }

    // display the history and occurance to desinated div
    function displaySearchHistory(searchHistory) {
      historyP.textContent = searchHistory;
      // keep track of occrance and update
      let newArray = [], wordObj;
      searchHistory.forEach(function (word) {
        wordObj = newArray.filter(function (w) {
          return w.text == word;
        });
        if (wordObj.length) {
          wordObj[0].size += 1;
        } else {
          newArray.push({ text: word, size: 1 });
        }
      });
      occranceP.textContent = JSON.stringify(newArray);
    }
  </script>
</body>

</html>